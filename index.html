
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>GeoMesh | P2P Proximity</title>
  <link rel="stylesheet" href="./styles.css">
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#008069">
  
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "h3-js": "https://esm.sh/h3-js@4.1.0?bundle",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
  <div id="root">
    <div id="boot-screen" class="boot-screen">
      <div class="loader"></div>
      <div id="boot-status" class="boot-status">Installing Mesh Protocol...</div>
    </div>
  </div>

  <script>
    async function boot() {
      if (!('serviceWorker' in navigator)) {
        document.getElementById('boot-status').innerText = "Service Worker Not Supported";
        return;
      }

      try {
        // Register the compiler Service Worker
        const reg = await navigator.serviceWorker.register('./sw.js');
        
        // Wait for it to be active
        if (reg.installing) {
          await new Promise(resolve => {
             const worker = reg.installing;
             worker.addEventListener('statechange', () => {
               if (worker.state === 'activated') resolve();
             });
          });
        } else if (!navigator.serviceWorker.controller) {
          // If registered but not controlling, reload to take control
          window.location.reload();
          return;
        }

        // Now that SW is controlling, inject the main entry point
        const script = document.createElement('script');
        script.type = 'module';
        script.src = './index.tsx';
        document.body.appendChild(script);

      } catch (err) {
        console.error("Boot failed:", err);
        document.getElementById('boot-status').innerText = "Boot Failed. Check Console.";
      }
    }

    boot();
  </script>
</body>
</html>
